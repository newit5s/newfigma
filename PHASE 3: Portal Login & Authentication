# PHASE 3: Portal Login & Authentication

## ğŸ¯ Objective
Create modern login interface vÃ  authentication flow cho restaurant manager portal dá»±a trÃªn Figma design, giá»¯ nguyÃªn existing session management system.

## ğŸ“‹ Dependencies
- **Phase 1**: Design system CSS variables
- **Existing Backend**: `RB_Portal_Session_Manager`, `RB_Portal_Account_Manager`

## ğŸ“¦ Deliverables
1. **portal-auth.css** - Login interface styles
2. **portal-auth.js** - Authentication interactions
3. **portal-login.php** - Login form template
4. **class-modern-portal-auth.php** - WordPress integration

## ğŸ¨ Design Specifications

### Login Page Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚          ğŸ½ï¸ Restaurant                   â”‚
â”‚             Manager                     â”‚
â”‚                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                             â”‚     â”‚
â”‚    â”‚        Login Form           â”‚     â”‚
â”‚    â”‚                             â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚         Forgot Password?               â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Login Form Structure
```html
<div class="rb-portal-login-container">
  <div class="rb-portal-login-card">
    <!-- Logo/Branding -->
    <div class="rb-portal-logo">
      <div class="rb-logo-icon">ğŸ½ï¸</div>
      <h1 class="rb-logo-text">Restaurant Manager</h1>
      <p class="rb-logo-subtitle">Staff Portal</p>
    </div>
    
    <!-- Login Form -->
    <form class="rb-portal-login-form" id="rb-portal-login">
      <div class="rb-form-group">
        <label class="rb-label" for="username">Username</label>
        <input type="text" class="rb-input rb-input-lg" id="username" 
               name="username" required autocomplete="username">
        <span class="rb-error-message" id="username-error"></span>
      </div>
      
      <div class="rb-form-group">
        <label class="rb-label" for="password">Password</label>
        <div class="rb-input-group">
          <input type="password" class="rb-input rb-input-lg" id="password" 
                 name="password" required autocomplete="current-password">
          <button type="button" class="rb-input-addon rb-password-toggle">
            <svg class="rb-eye-icon">...</svg>
          </button>
        </div>
        <span class="rb-error-message" id="password-error"></span>
      </div>
      
      <div class="rb-form-group rb-form-checkbox">
        <label class="rb-checkbox-label">
          <input type="checkbox" class="rb-checkbox" id="remember-me" name="remember">
          <span class="rb-checkbox-custom"></span>
          Remember me
        </label>
      </div>
      
      <button type="submit" class="rb-btn rb-btn-primary rb-btn-lg rb-btn-block" 
              id="login-submit">
        <span class="rb-btn-text">Sign In</span>
        <div class="rb-btn-loading" style="display: none;">
          <div class="rb-loading-spinner"></div>
        </div>
      </button>
    </form>
    
    <!-- Additional Actions -->
    <div class="rb-portal-actions">
      <a href="#" class="rb-link" id="forgot-password">Forgot your password?</a>
    </div>
    
    <!-- Error/Success Messages -->
    <div class="rb-alert rb-alert-error" id="login-error" style="display: none;">
      <div class="rb-alert-content">
        <svg class="rb-alert-icon">...</svg>
        <span class="rb-alert-message"></span>
      </div>
    </div>
  </div>
  
  <!-- Background Decoration -->
  <div class="rb-portal-bg">
    <div class="rb-bg-pattern"></div>
  </div>
</div>
```

## ğŸ” Authentication Flow

### JavaScript Authentication Logic
```javascript
class PortalAuth {
  constructor() {
    this.form = document.getElementById('rb-portal-login');
    this.submitBtn = document.getElementById('login-submit');
    this.errorAlert = document.getElementById('login-error');
    
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.checkExistingSession();
  }
  
  bindEvents() {
    this.form.addEventListener('submit', this.handleLogin.bind(this));
    
    // Password toggle
    document.querySelector('.rb-password-toggle')
      .addEventListener('click', this.togglePassword.bind(this));
    
    // Forgot password
    document.getElementById('forgot-password')
      .addEventListener('click', this.handleForgotPassword.bind(this));
  }
  
  async handleLogin(e) {
    e.preventDefault();
    
    const formData = new FormData(this.form);
    const loginData = {
      username: formData.get('username'),
      password: formData.get('password'),
      remember: formData.get('remember') === 'on'
    };
    
    // Validate inputs
    if (!this.validateForm(loginData)) {
      return;
    }
    
    // Show loading state
    this.setLoadingState(true);
    
    try {
      const response = await this.submitLogin(loginData);
      
      if (response.success) {
        this.handleLoginSuccess(response);
      } else {
        this.handleLoginError(response.message);
      }
    } catch (error) {
      this.handleLoginError('Connection error. Please try again.');
    } finally {
      this.setLoadingState(false);
    }
  }
  
  async submitLogin(loginData) {
    const response = await fetch(rbPortalAuth.ajax_url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        action: 'rb_portal_login',  // Existing endpoint
        nonce: rbPortalAuth.nonce,
        ...loginData
      })
    });
    
    return await response.json();
  }
  
  validateForm(data) {
    let isValid = true;
    
    // Username validation
    if (!data.username.trim()) {
      this.showFieldError('username', 'Username is required');
      isValid = false;
    } else {
      this.clearFieldError('username');
    }
    
    // Password validation
    if (!data.password.trim()) {
      this.showFieldError('password', 'Password is required');
      isValid = false;
    } else {
      this.clearFieldError('password');
    }
    
    return isValid;
  }
  
  handleLoginSuccess(response) {
    // Show success state briefly
    this.showSuccessMessage('Login successful! Redirecting...');
    
    // Redirect to portal dashboard
    setTimeout(() => {
      window.location.href = response.redirect_url || '/portal-dashboard';
    }, 1000);
  }
  
  handleLoginError(message) {
    this.showAlert('error', message);
    
    // Shake animation for form
    this.form.classList.add('rb-shake');
    setTimeout(() => {
      this.form.classList.remove('rb-shake');
    }, 500);
  }
  
  setLoadingState(loading) {
    const btnText = this.submitBtn.querySelector('.rb-btn-text');
    const btnLoading = this.submitBtn.querySelector('.rb-btn-loading');
    
    if (loading) {
      btnText.style.display = 'none';
      btnLoading.style.display = 'block';
      this.submitBtn.disabled = true;
    } else {
      btnText.style.display = 'block';
      btnLoading.style.display = 'none';
      this.submitBtn.disabled = false;
    }
  }
  
  togglePassword() {
    const passwordInput = document.getElementById('password');
    const eyeIcon = document.querySelector('.rb-eye-icon');
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.classList.add('rb-eye-slash');
    } else {
      passwordInput.type = 'password';
      eyeIcon.classList.remove('rb-eye-slash');
    }
  }
  
  checkExistingSession() {
    // Check if user already logged in
    if (rbPortalAuth.is_logged_in) {
      window.location.href = rbPortalAuth.dashboard_url;
    }
  }
}

// Initialize when DOM ready
document.addEventListener('DOMContentLoaded', () => {
  new PortalAuth();
});
```

## ğŸ¨ CSS Styles

### Login Container
```css
.rb-portal-login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--rb-primary-500) 0%, var(--rb-primary-600) 100%);
  position: relative;
  overflow: hidden;
}

.rb-portal-bg {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 0;
}

.rb-bg-pattern {
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(255,255,255,0.1) 0%, transparent 50%);
  background-size: 200px 200px;
  opacity: 0.5;
}
```

### Login Card
```css
.rb-portal-login-card {
  background: var(--rb-bg-primary);
  border-radius: var(--rb-radius-xl);
  box-shadow: var(--rb-shadow-xl);
  padding: var(--rb-space-8);
  width: 100%;
  max-width: 400px;
  position: relative;
  z-index: 1;
  animation: slideUp 0.5s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 640px) {
  .rb-portal-login-card {
    margin: var(--rb-space-4);
    padding: var(--rb-space-6);
  }
}
```

### Logo Section
```css
.rb-portal-logo {
  text-align: center;
  margin-bottom: var(--rb-space-8);
}

.rb-logo-icon {
  font-size: 3rem;
  margin-bottom: var(--rb-space-2);
}

.rb-logo-text {
  font-size: var(--rb-text-2xl);
  font-weight: var(--rb-font-bold);
  color: var(--rb-text-primary);
  margin: 0 0 var(--rb-space-1) 0;
}

.rb-logo-subtitle {
  color: var(--rb-text-secondary);
  margin: 0;
  font-size: var(--rb-text-base);
}
```

### Form Elements
```css
.rb-portal-login-form .rb-form-group {
  margin-bottom: var(--rb-space-6);
}

.rb-input-lg {
  padding: var(--rb-space-4);
  font-size: var(--rb-text-lg);
  min-height: 52px;
}

.rb-input-group {
  position: relative;
  display: flex;
}

.rb-input-group .rb-input {
  padding-right: var(--rb-space-12);
}

.rb-input-addon {
  position: absolute;
  right: var(--rb-space-3);
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  padding: var(--rb-space-2);
  cursor: pointer;
  color: var(--rb-text-secondary);
  transition: color var(--rb-transition-fast);
}

.rb-input-addon:hover {
  color: var(--rb-text-primary);
}

.rb-password-toggle .rb-eye-icon {
  width: 20px;
  height: 20px;
}
```

### Checkbox Styling
```css
.rb-form-checkbox {
  margin-bottom: var(--rb-space-4);
}

.rb-checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: var(--rb-text-sm);
  color: var(--rb-text-secondary);
}

.rb-checkbox {
  display: none;
}

.rb-checkbox-custom {
  width: 18px;
  height: 18px;
  border: 2px solid var(--rb-border);
  border-radius: var(--rb-radius-sm);
  margin-right: var(--rb-space-3);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--rb-transition-fast);
}

.rb-checkbox:checked + .rb-checkbox-custom {
  background: var(--rb-primary-500);
  border-color: var(--rb-primary-500);
}

.rb-checkbox:checked + .rb-checkbox-custom::after {
  content: 'âœ“';
  color: white;
  font-size: 12px;
  font-weight: bold;
}
```

### Alert Messages
```css
.rb-alert {
  padding: var(--rb-space-4);
  border-radius: var(--rb-radius);
  margin-bottom: var(--rb-space-4);
  display: flex;
  align-items: flex-start;
}

.rb-alert-error {
  background: #fef2f2;
  border: 1px solid #fecaca;
  color: #dc2626;
}

.rb-alert-success {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  color: #16a34a;
}

.rb-alert-content {
  display: flex;
  align-items: center;
  width: 100%;
}

.rb-alert-icon {
  width: 20px;
  height: 20px;
  margin-right: var(--rb-space-3);
  flex-shrink: 0;
}

.rb-alert-message {
  flex: 1;
}
```

### Animation Effects
```css
.rb-shake {
  animation: shake 0.5s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.rb-btn-loading .rb-loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

## ğŸ”§ WordPress Integration

### Portal Auth Class
```php
// public/class-modern-portal-auth.php
class RB_Modern_Portal_Auth {
    
    private $session_manager;
    
    public function __construct() {
        $this->session_manager = new RB_Portal_Session_Manager();
        
        add_action('init', array($this, 'handle_portal_access'));
        add_action('wp_enqueue_scripts', array($this, 'enqueue_auth_assets'));
        add_action('wp_ajax_nopriv_rb_portal_login', array($this, 'handle_ajax_login'));
        add_action('wp_ajax_rb_portal_logout', array($this, 'handle_ajax_logout'));
    }
    
    public function handle_portal_access() {
        // Check if accessing portal pages
        if (is_page('portal') || isset($_GET['rb_portal'])) {
            if (!$this->session_manager->is_logged_in()) {
                $this->render_login_page();
                exit;
            } else {
                // Redirect to dashboard or requested page
                $this->handle_portal_routing();
            }
        }
    }
    
    public function render_login_page() {
        // Enqueue assets
        $this->enqueue_auth_assets();
        
        // Set page title
        add_filter('pre_get_document_title', function() {
            return 'Staff Login - Restaurant Manager';
        });
        
        // Render login template
        include plugin_dir_path(__FILE__) . 'partials/portal-login.php';
    }
    
    public function enqueue_auth_assets() {
        wp_enqueue_style('rb-portal-auth', 
            plugin_dir_url(__FILE__) . '../assets/css/portal-auth.css',
            array('rb-design-system'),
            '1.0.0'
        );
        
        wp_enqueue_script('rb-portal-auth',
            plugin_dir_url(__FILE__) . '../assets/js/portal-auth.js',
            array(),
            '1.0.0',
            true
        );
        
        wp_localize_script('rb-portal-auth', 'rbPortalAuth', array(
            'ajax_url' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('rb_portal_auth_nonce'),
            'is_logged_in' => $this->session_manager->is_logged_in(),
            'dashboard_url' => home_url('/portal-dashboard'),
            'strings' => array(
                'invalid_credentials' => __('Invalid username or password', 'restaurant-booking'),
                'connection_error' => __('Connection error. Please try again.', 'restaurant-booking'),
                'login_success' => __('Login successful! Redirecting...', 'restaurant-booking')
            )
        ));
    }
    
    public function handle_ajax_login() {
        check_ajax_referer('rb_portal_auth_nonce', 'nonce');
        
        $username = sanitize_text_field($_POST['username']);
        $password = $_POST['password'];
        $remember = isset($_POST['remember']) && $_POST['remember'] === 'true';
        
        // Use existing session manager login logic
        $login_result = $this->session_manager->login($username, $password, $remember);
        
        if ($login_result['success']) {
            wp_send_json_success(array(
                'message' => __('Login successful', 'restaurant-booking'),
                'redirect_url' => home_url('/portal-dashboard'),
                'user' => $login_result['user_data']
            ));
        } else {
            wp_send_json_error(array(
                'message' => $login_result['message'] ?: __('Invalid credentials', 'restaurant-booking')
            ));
        }
    }
    
    public function handle_ajax_logout() {
        check_ajax_referer('rb_portal_auth_nonce', 'nonce');
        
        $this->session_manager->logout();
        
        wp_send_json_success(array(
            'message' => __('Logged out successfully', 'restaurant-booking'),
            'redirect_url' => home_url('/portal')
        ));
    }
    
    private function handle_portal_routing() {
        // Get current user data
        $current_user = $this->session_manager->get_current_user();
        
        if (!$current_user) {
            wp_redirect(home_url('/portal'));
            exit;
        }
        
        // Route to appropriate portal page
        $requested_page = isset($_GET['page']) ? sanitize_text_field($_GET['page']) : 'dashboard';
        
        switch ($requested_page) {
            case 'dashboard':
                $this->load_dashboard();
                break;
            case 'bookings':
                $this->load_bookings_page();
                break;
            case 'tables':
                $this->load_tables_page();
                break;
            case 'customers':
                $this->load_customers_page();
                break;
            default:
                $this->load_dashboard();
        }
    }
    
    private function load_dashboard() {
        // This will be implemented in Phase 4
        include plugin_dir_path(__FILE__) . 'partials/portal-dashboard.php';
    }
}
```

### Login Template
```php
<!-- public/partials/portal-login.php -->
<!DOCTYPE html>
<html <?php language_attributes(); ?>>
<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Staff Login - Restaurant Manager</title>
    <?php wp_head(); ?>
</head>
<body class="rb-portal-login-body">
    
    <div class="rb-portal-login-container">
        <div class="rb-portal-login-card">
            <!-- Logo Section -->
            <div class="rb-portal-logo">
                <div class="rb-logo-icon">ğŸ½ï¸</div>
                <h1 class="rb-logo-text"><?php _e('Restaurant Manager', 'restaurant-booking'); ?></h1>
                <p class="rb-logo-subtitle"><?php _e('Staff Portal', 'restaurant-booking'); ?></p>
            </div>
            
            <!-- Login Form -->
            <form class="rb-portal-login-form" id="rb-portal-login" method="post">
                <?php wp_nonce_field('rb_portal_login_nonce', 'login_nonce'); ?>
                
                <div class="rb-form-group">
                    <label class="rb-label" for="username">
                        <?php _e('Username', 'restaurant-booking'); ?>
                    </label>
                    <input type="text" 
                           class="rb-input rb-input-lg" 
                           id="username" 
                           name="username" 
                           required 
                           autocomplete="username"
                           placeholder="<?php esc_attr_e('Enter your username', 'restaurant-booking'); ?>">
                    <span class="rb-error-message" id="username-error"></span>
                </div>
                
                <div class="rb-form-group">
                    <label class="rb-label" for="password">
                        <?php _e('Password', 'restaurant-booking'); ?>
                    </label>
                    <div class="rb-input-group">
                        <input type="password" 
                               class="rb-input rb-input-lg" 
                               id="password" 
                               name="password" 
                               required 
                               autocomplete="current-password"
                               placeholder="<?php esc_attr_e('Enter your password', 'restaurant-booking'); ?>">
                        <button type="button" class="rb-input-addon rb-password-toggle" aria-label="Toggle password visibility">
                            <svg class="rb-eye-icon" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                            </svg>
                        </button>
                    </div>
                    <span class="rb-error-message" id="password-error"></span>
                </div>
                
                <div class="rb-form-group rb-form-checkbox">
                    <label class="rb-checkbox-label">
                        <input type="checkbox" class="rb-checkbox" id="remember-me" name="remember">
                        <span class="rb-checkbox-custom"></span>
                        <?php _e('Remember me for 30 days', 'restaurant-booking'); ?>
                    </label>
                </div>
                
                <button type="submit" class="rb-btn rb-btn-primary rb-btn-lg rb-btn-block" id="login-submit">
                    <span class="rb-btn-text"><?php _e('Sign In', 'restaurant-booking'); ?></span>
                    <div class="rb-btn-loading" style="display: none;">
                        <div class="rb-loading-spinner"></div>
                    </div>
                </button>
            </form>
            
            <!-- Additional Actions -->
            <div class="rb-portal-actions">
                <a href="#" class="rb-link" id="forgot-password">
                    <?php _e('Forgot your password?', 'restaurant-booking'); ?>
                </a>
            </div>
            
            <!-- Alert Messages -->
            <div class="rb-alert rb-alert-error" id="login-error" style="display: none;">
                <div class="rb-alert-content">
                    <svg class="rb-alert-icon" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span class="rb-alert-message"></span>
                </div>
            </div>
            
            <div class="rb-alert rb-alert-success" id="login-success" style="display: none;">
                <div class="rb-alert-content">
                    <svg class="rb-alert-icon" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span class="rb-alert-message"></span>
                </div>
            </div>
        </div>
        
        <!-- Background -->
        <div class="rb-portal-bg">
            <div class="rb-bg-pattern"></div>
        </div>
    </div>
    
    <!-- Forgot Password Modal (Optional) -->
    <div class="rb-modal-overlay" id="forgot-password-modal" style="display: none;">
        <div class="rb-modal rb-modal-sm">
            <div class="rb-modal-header">
                <h3 class="rb-modal-title"><?php _e('Reset Password', 'restaurant-booking'); ?></h3>
                <button class="rb-modal-close" type="button">&times;</button>
            </div>
            <div class="rb-modal-body">
                <p><?php _e('Please contact your administrator to reset your password.', 'restaurant-booking'); ?></p>
                <div class="rb-form-group">
                    <label class="rb-label"><?php _e('Administrator Email', 'restaurant-booking'); ?></label>
                    <input type="email" class="rb-input" value="<?php echo esc_attr(get_option('admin_email')); ?>" readonly>
                </div>
            </div>
            <div class="rb-modal-footer">
                <button class="rb-btn rb-btn-secondary" type="button" data-dismiss="modal">
                    <?php _e('Close', 'restaurant-booking'); ?>
                </button>
            </div>
        </div>
    </div>
    
    <?php wp_footer(); ?>
</body>
</html>
```

## ğŸ¨ Advanced Styling Features

### Dark Mode Support
```css
/* Dark mode for login page */
[data-theme="dark"] .rb-portal-login-container {
  background: linear-gradient(135deg, var(--rb-gray-800) 0%, var(--rb-gray-900) 100%);
}

[data-theme="dark"] .rb-portal-login-card {
  background: var(--rb-gray-800);
  border: 1px solid var(--rb-gray-700);
}

[data-theme="dark"] .rb-logo-text {
  color: var(--rb-gray-100);
}

[data-theme="dark"] .rb-logo-subtitle {
  color: var(--rb-gray-400);
}
```

### Loading Screen (Optional)
```css
.rb-portal-loading {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--rb-bg-primary);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.rb-portal-loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--rb-gray-200);
  border-top: 4px solid var(--rb-primary-500);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: var(--rb-space-4);
}

.rb-portal-loading-text {
  color: var(--rb-text-secondary);
  font-size: var(--rb-text-sm);
}
```

## ğŸ§ª Testing Requirements

### Functional Testing
1. **Login Flow**
   - [ ] Valid credentials login successfully
   - [ ] Invalid credentials show error
   - [ ] Remember me checkbox works
   - [ ] Password visibility toggle works
   - [ ] Forgot password modal opens

2. **Session Management**
   - [ ] Successful login redirects to dashboard
   - [ ] Already logged in users bypass login
   - [ ] Session persists across browser tabs
   - [ ] Remember me extends session duration

3. **Error Handling**
   - [ ] Network errors handled gracefully
   - [ ] Form validation prevents empty submission
   - [ ] Clear error messages displayed
   - [ ] Form shake animation on error

4. **Security**
   - [ ] CSRF protection with nonces
   - [ ] Password fields autocomplete properly
   - [ ] No sensitive data in browser console
   - [ ] Proper session cleanup on logout

### Accessibility Testing
- [ ] Keyboard navigation works
- [ ] Screen reader friendly labels
- [ ] Focus indicators visible
- [ ] Color contrast meets WCAG standards
- [ ] Error messages announced

### Performance Testing
- [ ] Login page loads in <2s
- [ ] Login submission responds in <1s
- [ ] Smooth animations (60fps)
- [ ] No memory leaks

## ğŸ“± Mobile Responsiveness

### Mobile Specific Styles
```css
@media (max-width: 640px) {
  .rb-portal-login-container {
    padding: var(--rb-space-4);
  }
  
  .rb-portal-login-card {
    padding: var(--rb-space-6);
    margin: 0;
    border-radius: var(--rb-radius-lg);
  }
  
  .rb-logo-text {
    font-size: var(--rb-text-xl);
  }
  
  .rb-input-lg {
    font-size: var(--rb-text-base);
    min-height: 48px;
  }
  
  .rb-btn-lg {
    padding: var(--rb-space-4);
    font-size: var(--rb-text-base);
  }
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  .rb-btn, .rb-input, .rb-input-addon {
    min-height: 44px;
  }
  
  .rb-checkbox-custom {
    min-width: 20px;
    min-height: 20px;
  }
}
```

## ğŸ¯ Success Criteria

### Visual Requirements
- [ ] Matches modern Figma design patterns
- [ ] Consistent with Phase 1 design system
- [ ] Professional, trustworthy appearance
- [ ] Smooth loading and transition animations

### Functional Requirements
- [ ] Integrates with existing `RB_Portal_Session_Manager`
- [ ] Maintains all current security features
- [ ] Preserves session persistence logic
- [ ] Works with existing portal routing

### Performance Requirements
- [ ] Fast initial page load
- [ ] Responsive form interactions
- [ ] Optimized for mobile devices
- [ ] Accessible across all browsers

### Security Requirements
- [ ] CSRF protection maintained
- [ ] Password handling secure
- [ ] Session management intact
- [ ] No security regressions

## ğŸ“ Expected File Outputs

```
assets/css/portal-auth.css            # Complete login styles
assets/js/portal-auth.js              # Authentication logic
public/class-modern-portal-auth.php   # WordPress integration
public/partials/portal-login.php      # Login template
```

## ğŸ”— Integration Notes

- Must work with existing `RB_Portal_Session_Manager` class
- Preserve all current authentication logic
- Maintain compatibility with existing portal routing
- Support current password reset workflow
- Work with existing multi-language system

Focus on creating a beautiful, modern login experience that builds trust and provides smooth authentication flow!
